<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>About Docker network - Part 1 | Lynn&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="DockerNetwork" />
  
  
  
  
  <meta name="description" content="Networking of Docker is a topic that I always want to talk about, so in the upcoming several About Docker network posts, including this one, I will try to introduce different networking modes of Docke">
<meta property="og:type" content="article">
<meta property="og:title" content="About Docker network - Part 1">
<meta property="og:url" content="http://lzreload.com/en/2022/09/16/Docker-NetWork-1/index.html">
<meta property="og:site_name" content="Lynn&#39;s Blog">
<meta property="og:description" content="Networking of Docker is a topic that I always want to talk about, so in the upcoming several About Docker network posts, including this one, I will try to introduce different networking modes of Docke">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://lzreload.com/en/2022/09/16/Docker-NetWork-1/docker_bridge.png">
<meta property="og:image" content="http://lzreload.com/en/2022/09/16/Docker-NetWork-1/docker_bridge_internal.png">
<meta property="og:image" content="http://lzreload.com/en/2022/09/16/Docker-NetWork-1/docker_bridge_external.png">
<meta property="article:published_time" content="2022-09-16T10:40:25.000Z">
<meta property="article:modified_time" content="2022-09-26T06:36:55.578Z">
<meta property="article:author" content="Lynn Zhou">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="Network">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://lzreload.com/en/2022/09/16/Docker-NetWork-1/docker_bridge.png">
  
    <link rel="alternate" href="/atom.xml" title="Lynn&#39;s Blog" type="application/atom+xml">
  
  <link rel="icon" href="/en/css/images/favicon.ico">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  
<link rel="stylesheet" href="/en/css/style.css">


  
<script src="/en/js/jquery-3.1.1.min.js"></script>


  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/en/css/bootstrap.css" >
  <link rel="stylesheet" href="/en/css/fashion.css" >
  <link rel="stylesheet" href="/en/css/glyphs.css" >

<meta name="generator" content="Hexo 5.4.0"></head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  
  <div class="site-header-image">
    <img id="originBg" width="100%" alt="Hike News" src="">
  </div>

  <div id="header-blur" class="site-header-image blur" style="position: absolute; top:0; height: 207px; min-height: 207px; min-width: 100%;">
    <img id="blurBg" width="100%" style="top: 96%" alt="Hike News" src="">
  </div>

  <script>
        var imgUrls = "css/images/pose01.jpg,https://source.unsplash.com/collection/954550/1920x1080,https://source.unsplash.com/collection/954550/1920x1081".split(",");
        var random = Math.floor((Math.random() * imgUrls.length ));
        if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
          document.getElementById("originBg").src=imgUrls[random];
          document.getElementById("blurBg").src=imgUrls[random];
        } else {
          document.getElementById("originBg").src='/en/' + imgUrls[random];
          document.getElementById("blurBg").src='/en/' + imgUrls[random];
        }
    </script>




<header id="allheader" class="site-header" role="banner" 
   style="width: 100%; position: absolute; top:0; background: rgba(255,255,255,.8);"  >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/en/" title="Lynn&#39;s Blog" rel="home"> Lynn&#39;s Blog </a>
            
          </h1>
          
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663" linktext="/"> <a class="" href="/en/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663" linktext="archives"> <a class="" href="/en/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663" linktext="categories"> <a class="" href="/en/categories">Categories</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663" linktext="tags"> <a class="" href="/en/tags">Tags</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-Docker-NetWork-1" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      About Docker network - Part 1
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/en/2022/09/16/Docker-NetWork-1/" class="article-date">
	  <time datetime="2022-09-16T10:40:25.000Z" itemprop="datePublished">September 16, 2022</time>
	</a>

       
      
	<span id="busuanzi_container_page_pv">
	  本文总阅读量<span id="busuanzi_value_page_pv"></span>次
	</span>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Networking of Docker is a topic that I always want to talk about, so in the upcoming several <strong><code>About Docker network</code></strong> posts, including this one, I will try to introduce different networking modes of Docker and explain how it works based on some experiments I’ve made.<br>This blog post is focus on Docker’s <code>none</code>, <code>host</code> and <code>bridege</code> network modes, others will be talked about in next posts.</p>
<span id="more"></span>

<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>According to docker’s official document, docker’s networking subsystem(libnetwork) is portable, it’s using driver to provide networking functionality. Currently, these drivers exist by default:</p>
<ul>
<li>bridge</li>
<li>host</li>
<li>overlay</li>
<li>ipvlan</li>
<li>macvlan</li>
</ul>
<p>If we use <code>docker network ls</code> command to list networks offered by docker by default we can see:</p>
<pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">$ docker network ls
NETWORK ID     NAME      DRIVER    SCOPE
2fd34f93b369   bridge    bridge    local
8e489d56f4d5   host      host      local
2f7960394c0f   none      null      local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>None</code>, <code>host</code>, and <code>bridge</code> network are created by default once docker starts. <code>host</code> and <code>bridge</code> network is using <code>host</code> and <code>bridge</code> driver respectively mentioned above while <code>none</code> network is created without network driver. These three networks will be discussed in this article mainly about how containers will act when they are connected to different networks.</p>
<h1 id="None"><a href="#None" class="headerlink" title="None"></a>None</h1><p>Containers that are connected to <code>none</code> network will not have an external network interface:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Create a container with `none` network mode </span>
$ docker run --rm -dit --network none --name no-net-alpine alpine:latest ash

<span class="token comment"># Check container's network</span>
$ docker <span class="token builtin class-name">exec</span> no-net-alpine <span class="token function">ip</span> <span class="token function">link</span> show
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Container with this mode of networking will only have a loopback interface, which means that it’s unable to send messages to other containers or external networks.</p>
<h1 id="Host"><a href="#Host" class="headerlink" title="Host"></a>Host</h1><p>Before we create a new container, we can inspect the network interface of the host first:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Local host</span>
$ <span class="token function">ifconfig</span>
docker0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">409</span><span class="token operator"><span class="token file-descriptor important">9</span>&lt;</span>UP,BROADCAST,MULTICAST<span class="token operator">></span>  mtu <span class="token number">1500</span>
        inet <span class="token number">172.17</span>.0.1  netmask <span class="token number">255.255</span>.0.0  broadcast <span class="token number">172.17</span>.255.255
<span class="token punctuation">..</span>.

ens192: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">></span>  mtu <span class="token number">1500</span>
<span class="token punctuation">..</span>.

lo: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class="token operator">></span>  mtu <span class="token number">65536</span>
        inet <span class="token number">127.0</span>.0.1  netmask <span class="token number">255.0</span>.0.0
<span class="token punctuation">..</span>.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Then, let’s create a new container and connect it to the <code>host</code> network:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Create a new container with host network mode</span>
$ docker run --rm -dit --network <span class="token function">host</span> --name host-alpine alpine:latest ash

<span class="token comment"># Access to new container</span>
$ docker <span class="token builtin class-name">exec</span> -it host-alpine /bin/sh

<span class="token comment"># Container host-alpine</span>
$ <span class="token function">ifconfig</span>
docker0   Link encap:Ethernet  HWaddr 02:42:D3:3C:90:82  
          inet addr:172.17.0.1  Bcast:172.17.255.255  Mask:255.255.0.0
<span class="token punctuation">..</span>.

ens192    Link encap:Ethernet  HWaddr 00:50:56:BA:06:B7  
<span class="token punctuation">..</span>.

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>According to the container shown above, we can observe that this new container has exact same network interfaces as the host which means that, it shares the host’s networking namespaces.</p>
<p>We can just consider it a normal app running on our computer. For example, we can also create an Nginx container with <code>host</code> network:</p>
<pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token comment"># Host (No need to add --p to expose port 80 when using host network)</span>
$ docker run --rm -d --network host --name my_nginx nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Then we can try to sent request to Nginx from Container host-alpine:</p>
<pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token comment"># Access previous host container(host-alpine)</span>
$ docker exec -it host-alpine /bin/sh
<span class="token comment"># Container host-alpine</span>
$ curl localhost:80
&lt;!DOCTYPE html>
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Since container <code>my_nginx</code> and <code>host-alpine</code> are all connecting to <code>host</code> network, they all share the host’s network namespace, so that <code>host-alpine</code> can directly use <code>localhost:80</code> to send requests to <code>my_nginx</code>.</p>
<h1 id="Bridge"><a href="#Bridge" class="headerlink" title="Bridge"></a>Bridge</h1><h2 id="About-Bridge-mode"><a href="#About-Bridge-mode" class="headerlink" title="About Bridge mode"></a>About Bridge mode</h2><p><code>Bridge</code> is the default network driver of docker. </p>
<p>When we talk about <code>bridge network</code>, we are talking about a Link Layer device(a hardware device or a software device) that forwards traffic between network segments.</p>
<p>In <code>Docker</code>, a software bridge is used for containers to connect to the same bridge network in order to communicate with each other.</p>
<p>Before we start to create a container with <code>bridge</code> network type, we can check the initial state of our local environment first:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Inspect the ethernet bridge configuration</span>
$ brctl show
bridge name     bridge <span class="token function">id</span>               STP enabled     interfaces
docker0         <span class="token number">8000</span>.02428ab4554d       no

$ <span class="token function">ip</span> <span class="token function">link</span> show
<span class="token punctuation">..</span>.
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>NO-CARRIER,BROADCAST,MULTICAST,UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state DOWN mode DEFAULT group default 
    link/ether 02:42:8a:b4:55:4d brd ff:ff:ff:ff:ff:ff
<span class="token punctuation">..</span>.

<span class="token comment"># Show IP routing table</span>
$ route -n
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
<span class="token number">0.0</span>.0.0         <span class="token number">10.103</span>.226.1    <span class="token number">0.0</span>.0.0         UG    <span class="token number">100</span>    <span class="token number">0</span>        <span class="token number">0</span> ens192
<span class="token number">10.103</span>.226.0    <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.255.0   U     <span class="token number">100</span>    <span class="token number">0</span>        <span class="token number">0</span> ens192
<span class="token number">172.17</span>.0.0      <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.0.0     U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> docker0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Create-container-with-bridge-mode-default"><a href="#Create-container-with-bridge-mode-default" class="headerlink" title="Create container with bridge mode(default):"></a>Create container with bridge mode(default):</h2><p>Then we can start to create a container:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Create a container with `bridge` network type</span>
$ docker run --rm -dit --name bridge-alpine alpine ash

<span class="token comment"># Check ips of container</span>
$ docker <span class="token builtin class-name">exec</span> bridge-alpine <span class="token function">ip</span> addr
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">7</span>: eth0@if8: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state UP 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Compared to the previous container with <code>none</code> network mode, this new container has one more network interface <code>eth0</code> and got an ip <code>172.17.0.2</code>.</p>
<p>Then we can check the network state of the current environment:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Inspect the ethernet bridge configuration</span>
$ brctl show
bridge name     bridge <span class="token function">id</span>               STP enabled     interfaces
docker0         <span class="token number">8000</span>.0242a1f90aad       no              veth80ec58c

$ <span class="token function">ip</span> <span class="token function">link</span> show
<span class="token punctuation">..</span>.
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state UP mode DEFAULT group default 
    link/ether 02:42:8a:b4:55:4d brd ff:ff:ff:ff:ff:ff
<span class="token number">8</span>: veth80ec58c@if7: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP mode DEFAULT group default 
    link/ether 0e:e2:2d:20:d2:ad brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Apparently, now that there’s a new interface <code>veth80ec58c</code> who is connecting to docker0. And also this new interface(<code>veth80ec58c</code>) and <code>interface 7</code> (shown in the container as interface <code>eth0</code>) are two connected endpoints of a <code>veth pair</code> that act as tunnels between network namespaces.</p>
<p><img src="docker_bridge.png" alt="docker_bridge.png"></p>
<h2 id="Communication-between-pods"><a href="#Communication-between-pods" class="headerlink" title="Communication between pods"></a>Communication between pods</h2><p> Now that we can create another two containers <code>bridge-alpine2</code> and <code>bridge-alpine3</code>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Create a new container</span>
$ docker run --rm -dit --name bridge-alpine2 alpine ash
$ docker run --rm -dit --name bridge-alpine3 alpine ash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Then we can observe that there’re two new interfaces that are connecting to docker0:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ brctl show                    
bridge name     bridge <span class="token function">id</span>       STP enabled       interfaces
docker0         <span class="token number">8000</span>.0242a1f90aad       no       veth4a318ba
                                                 veth80ec58c
                                                 vethd234967<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> We are going to ping container <code>bridge-alpine</code> from container <code>bridge-alpine2</code> using its IP (<code>172.17.0.2</code>) to observe the communication between pods.:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ docker <span class="token builtin class-name">exec</span> -it bridge-alpine2 /bin/sh
<span class="token comment"># Inside container bridge-alpine2(172.17.0.3)</span>
$ <span class="token function">ping</span> <span class="token number">172.17</span>.0.2
PING <span class="token number">172.17</span>.0.2 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.2<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.333</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.151</span> ms

<span class="token comment"># Host</span>
<span class="token comment"># Capture package from docker0</span>
$ tcpdump -i docker0 -v -nn -e -t
tcpdump: listening on docker0, link-type EN10MB <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>, capture size <span class="token number">262144</span> bytes
02:42:ac:11:00:03 <span class="token operator">></span> **ff:ff:ff:ff:ff:ff**, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Request who-has <span class="token number">172.17</span>.0.2 tell <span class="token number">172.17</span>.0.3, length <span class="token number">28</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Reply <span class="token number">172.17</span>.0.2 is-at 02:42:ac:11:00:02, length <span class="token number">28</span>
02:42:ac:11:00:03 <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">7910</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.3 <span class="token operator">></span> <span class="token number">172.17</span>.0.2: ICMP <span class="token builtin class-name">echo</span> request, <span class="token function">id</span> <span class="token number">16</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">59835</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2 <span class="token operator">></span> <span class="token number">172.17</span>.0.3: ICMP <span class="token builtin class-name">echo</span> reply, <span class="token function">id</span> <span class="token number">16</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>
02:42:ac:11:00:03 <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">7986</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>

<span class="token comment"># Container bridge-alpine2</span>
$ tcpdump -i veth4a318ba -v -nn -e -t
02:42:ac:11:00:03 <span class="token operator">></span> ff:ff:ff:ff:ff:ff, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Request who-has <span class="token number">172.17</span>.0.2 tell <span class="token number">172.17</span>.0.3, length <span class="token number">28</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Reply <span class="token number">172.17</span>.0.2 is-at 02:42:ac:11:00:02, length <span class="token number">28</span>
02:42:ac:11:00:03 <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">56762</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.3 <span class="token operator">></span> <span class="token number">172.17</span>.0.2: ICMP <span class="token builtin class-name">echo</span> request, <span class="token function">id</span> <span class="token number">17</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">55430</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2 <span class="token operator">></span> <span class="token number">172.17</span>.0.3: ICMP <span class="token builtin class-name">echo</span> reply, <span class="token function">id</span> <span class="token number">17</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>

<span class="token comment"># Container bridge-alpine</span>
$ tcpdump -i veth80ec58c -v -nn -e -t
tcpdump: listening on veth80ec58c, link-type EN10MB <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>, capture size <span class="token number">262144</span> bytes
02:42:ac:11:00:03 <span class="token operator">></span> ff:ff:ff:ff:ff:ff, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Request who-has <span class="token number">172.17</span>.0.2 tell <span class="token number">172.17</span>.0.3, length <span class="token number">28</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Reply <span class="token number">172.17</span>.0.2 is-at 02:42:ac:11:00:02, length <span class="token number">28</span>
02:42:ac:11:00:03 <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">7910</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.3 <span class="token operator">></span> <span class="token number">172.17</span>.0.2: ICMP <span class="token builtin class-name">echo</span> request, <span class="token function">id</span> <span class="token number">16</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">59835</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2 <span class="token operator">></span> <span class="token number">172.17</span>.0.3: ICMP <span class="token builtin class-name">echo</span> reply, <span class="token function">id</span> <span class="token number">16</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>

<span class="token comment"># Container bridge-alpine3</span>
$ tcpdump -i vethd234967 -v -nn -e -t
tcpdump: listening on vethd234967, link-type EN10MB <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>, capture size <span class="token number">262144</span> bytes
02:42:ac:11:00:03 <span class="token operator">></span> ff:ff:ff:ff:ff:ff, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Request who-has <span class="token number">172.17</span>.0.2 tell <span class="token number">172.17</span>.0.3, length <span class="token number">28</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Network-traffic-analysis"><a href="#Network-traffic-analysis" class="headerlink" title="Network traffic analysis"></a>Network traffic analysis</h3><p>According to the results that are shown above, the process is a bit different:</p>
<ol>
<li><strong>Use ARP to get the MAC address of the target container：</strong></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># bridge-alpine2 container</span>
$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
<span class="token number">0.0</span>.0.0         <span class="token number">172.17</span>.0.1      <span class="token number">0.0</span>.0.0         UG    <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0
<span class="token number">172.17</span>.0.0      <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.0.0     U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>According to the IP routing table of container bridge-alpine2 shown above, when the container wants to ping another container in the same subnet(172.17.0.0/16), the message can be directly sent to them, instead of being sent to the gateway. But it needs to know the MAC address of the target container first.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># bridge-alpine2's packages</span>
02:42:ac:11:00:03 <span class="token operator">></span> ff:ff:ff:ff:ff:ff, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Request who-has <span class="token number">172.17</span>.0.2 tell <span class="token number">172.17</span>.0.3, length <span class="token number">28</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Reply <span class="token number">172.17</span>.0.2 is-at 02:42:ac:11:00:02, length <span class="token number">28</span>

<span class="token comment"># docker0's packcages </span>
02:42:ac:11:00:03 <span class="token operator">></span> **ff:ff:ff:ff:ff:ff**, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Request who-has <span class="token number">172.17</span>.0.2 tell <span class="token number">172.17</span>.0.3, length <span class="token number">28</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Reply <span class="token number">172.17</span>.0.2 is-at 02:42:ac:11:00:02, length <span class="token number">28</span>

<span class="token comment"># bridge-alpine's packages</span>
02:42:ac:11:00:03 <span class="token operator">></span> **ff:ff:ff:ff:ff:ff**, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Request who-has <span class="token number">172.17</span>.0.2 tell <span class="token number">172.17</span>.0.3, length <span class="token number">28</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Reply <span class="token number">172.17</span>.0.2 is-at 02:42:ac:11:00:02, length <span class="token number">28</span>

<span class="token comment"># bridge-alpine3's packages</span>
02:42:ac:11:00:03 <span class="token operator">></span> **ff:ff:ff:ff:ff:ff**, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Request who-has <span class="token number">172.17</span>.0.2 tell <span class="token number">172.17</span>.0.3, length <span class="token number">28</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>So, from the content shown above, we can observe that the container broadcasted the ARP message using the broadcast MAC address(<strong>ff:ff:ff:ff:ff:ff</strong>). ARP request will be sent to all the containers which are connecting to docker0, but only the target container bridge-alpine(172.17.0.2) replied with its MAC address(02:42:ac:11:00:02).</p>
<ol>
<li><strong>Send packages (ICMP)</strong></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># bridge-alpine2's packages</span>
02:42:ac:11:00:03 <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">56762</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.3 <span class="token operator">></span> <span class="token number">172.17</span>.0.2: ICMP <span class="token builtin class-name">echo</span> request, <span class="token function">id</span> <span class="token number">17</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">55430</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2 <span class="token operator">></span> <span class="token number">172.17</span>.0.3: ICMP <span class="token builtin class-name">echo</span> reply, <span class="token function">id</span> <span class="token number">17</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>

<span class="token comment"># docker0's packages</span>
02:42:ac:11:00:03 <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">7910</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.3 <span class="token operator">></span> <span class="token number">172.17</span>.0.2: ICMP <span class="token builtin class-name">echo</span> request, <span class="token function">id</span> <span class="token number">16</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">59835</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2 <span class="token operator">></span> <span class="token number">172.17</span>.0.3: ICMP <span class="token builtin class-name">echo</span> reply, <span class="token function">id</span> <span class="token number">16</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>

<span class="token comment"># bridge-alpine's packages</span>
02:42:ac:11:00:03 <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">7910</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.3 <span class="token operator">></span> <span class="token number">172.17</span>.0.2: ICMP <span class="token builtin class-name">echo</span> request, <span class="token function">id</span> <span class="token number">16</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:ac:11:00:03, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">59835</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2 <span class="token operator">></span> <span class="token number">172.17</span>.0.3: ICMP <span class="token builtin class-name">echo</span> reply, <span class="token function">id</span> <span class="token number">16</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>With the IP and MAC address, now container bridge-alpine2 can start to send IMCP messages to container bridge-alpine:</p>
<p><img src="docker_bridge_internal.png" alt="docker_bridge_internal.png"></p>
<h2 id="Communicate-with-external-network"><a href="#Communicate-with-external-network" class="headerlink" title="Communicate with external network"></a>Communicate with external network</h2><p>Let’s see what will happen if this container tries to access an <code>external network</code>. The original state of the local environment is shown below:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Show the system ARP cache </span>
$ arp -v
Address                  HWtype  HWaddress           Flags Mask            Iface
gateway                  ether   <span class="token number">70</span>:db:98:82:a1:c0   C                     ens192<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Container bridge-alpine2 and bridge-alpine3 have been removed from the local host.</p>
<p>We can ping a website from a container and use <code>tcpdump</code> to catch the packets during this process:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Ping a website from container with bridge network type</span>
$ docker <span class="token builtin class-name">exec</span> bridge-alpine <span class="token function">ping</span> www.baidu.com
PING www.baidu.com <span class="token punctuation">(</span><span class="token number">103.235</span>.46.40<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">103.235</span>.46.40: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">40</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">186.518</span> ms
<span class="token number">64</span> bytes from <span class="token number">103.235</span>.46.40: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">40</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">187.523</span> ms
<span class="token punctuation">..</span>.

<span class="token comment"># Get packets from one of the endpoints of the veth pairs which connects </span>
<span class="token comment"># container's network namespace and docker0</span>
$ tcpdump -i veth80ec58c -v -nn -e
02:42:ac:11:00:02 <span class="token operator">></span> 02:42:a1:f9:0a:ad, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Request who-has **172.17.0.1** tell <span class="token number">172.17</span>.0.2, length <span class="token number">28</span>
02:42:a1:f9:0a:ad <span class="token operator">></span> 02:42:ac:11:00:02, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Reply <span class="token number">172.17</span>.0.1 is-at **02:42:a1:f9:0a:ad**, length <span class="token number">2806</span>:38:42.580163 ARP, Reply localhost.localdomain is-at 02:42:8a:b4:55:4d <span class="token punctuation">(</span>oui Unknown<span class="token punctuation">)</span>, length <span class="token number">28</span>
02:42:ac:11:00:02 <span class="token operator">></span> **02:42:a1:f9:0a:ad**, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">73</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">46041</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">59</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2.37221 <span class="token operator">></span> <span class="token number">8.8</span>.8.8.53: <span class="token number">28492</span>+ A? www.baidu.com. <span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">)</span>
02:42:ac:11:00:02 <span class="token operator">></span> **02:42:a1:f9:0a:ad**, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">73</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">53494</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">59</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2.37221 <span class="token operator">></span> <span class="token number">8.8</span>.4.4.53: <span class="token number">28492</span>+ A? www.baidu.com. <span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">)</span>
02:42:ac:11:00:02 <span class="token operator">></span> **02:42:a1:f9:0a:ad**, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">73</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">46042</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">59</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2.37221 <span class="token operator">></span> <span class="token number">8.8</span>.8.8.53: <span class="token number">29411</span>+ AAAA? www.baidu.com. <span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">)</span>
02:42:ac:11:00:02 <span class="token operator">></span> **02:42:a1:f9:0a:ad**, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">73</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">53495</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">59</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2.37221 <span class="token operator">></span> <span class="token number">8.8</span>.4.4.53: <span class="token number">29411</span>+ AAAA? www.baidu.com. <span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">)</span>
**02:42:a1:f9:0a:ad** <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">132</span>: <span class="token punctuation">(</span>tos 0x20, ttl <span class="token number">101</span>, <span class="token function">id</span> <span class="token number">57650</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">118</span><span class="token punctuation">)</span>
    <span class="token number">8.8</span>.8.8.53 <span class="token operator">></span> <span class="token number">172.17</span>.0.2.37221: <span class="token number">28492</span> <span class="token number">3</span>/0/0 www.baidu.com. CNAME www.a.shifen.com., www.a.shifen.com. A <span class="token number">14.215</span>.177.38, www.a.shifen.com. A <span class="token number">14.215</span>.177.39 <span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span>
**02:42:a1:f9:0a:ad** <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">157</span>: <span class="token punctuation">(</span>tos 0x20, ttl <span class="token number">101</span>, <span class="token function">id</span> <span class="token number">29948</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">143</span><span class="token punctuation">)</span>
    <span class="token number">8.8</span>.8.8.53 <span class="token operator">></span> <span class="token number">172.17</span>.0.2.37221: <span class="token number">29411</span> <span class="token number">1</span>/1/0 www.baidu.com. CNAME www.a.shifen.com. <span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span>
02:42:ac:11:00:02 <span class="token operator">></span> **02:42:a1:f9:0a:ad**, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">31149</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2 <span class="token operator">></span> <span class="token number">14.215</span>.177.38: ICMP <span class="token builtin class-name">echo</span> request, <span class="token function">id</span> <span class="token number">69</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>
**02:42:a1:f9:0a:ad** <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x20, ttl <span class="token number">51</span>, <span class="token function">id</span> <span class="token number">31149</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">14.215</span>.177.38 <span class="token operator">></span> <span class="token number">172.17</span>.0.2: ICMP <span class="token builtin class-name">echo</span> reply, <span class="token function">id</span> <span class="token number">69</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Network-traffic-analysis-1"><a href="#Network-traffic-analysis-1" class="headerlink" title="Network traffic analysis"></a>Network traffic analysis</h3><p>There’re several steps shown in this process, let’s go through them one by one:</p>
<ol>
<li><strong>Use ARP to get the MAC address of the gateway：</strong></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># bridge-alpine container</span>
$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
<span class="token number">0.0</span>.0.0         <span class="token number">172.17</span>.0.1      <span class="token number">0.0</span>.0.0         UG    <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0
<span class="token number">172.17</span>.0.0      <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.0.0     U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Different from communicating with containers also connecting to docker0, Both DNS/ICMP messages need to be sent to external networks. In this case, according to the table shown above, container bridge-alpine should directly send messages to the gateway(172.17.0.1)</p>
<p>Somehow knowing the IP of the gateway is not enough for the packages to be delivered, they need the MAC address as well, so that the container used <code>ARP</code> to ask for the <code>MAC address</code> of the gateway(do not need to board cast):</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">02:42:ac:11:00:02 <span class="token operator">></span> 02:42:a1:f9:0a:ad, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Request who-has **172.17.0.1** tell <span class="token number">172.17</span>.0.2, length <span class="token number">28</span>
02:42:a1:f9:0a:ad <span class="token operator">></span> 02:42:ac:11:00:02, ethertype ARP <span class="token punctuation">(</span>0x0806<span class="token punctuation">)</span>, length <span class="token number">42</span>: Ethernet <span class="token punctuation">(</span>len <span class="token number">6</span><span class="token punctuation">)</span>, IPv4 <span class="token punctuation">(</span>len <span class="token number">4</span><span class="token punctuation">)</span>, Reply <span class="token number">172.17</span>.0.1 is-at **02:42:a1:f9:0a:ad**, length <span class="token number">2806</span>:38:42.580163 ARP, Reply localhost.localdomain is-at 02:42:8a:b4:55:4d <span class="token punctuation">(</span>oui Unknown<span class="token punctuation">)</span>, length <span class="token number">28</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>According to what we’ve got previously, the MAC address <code>02:42:a1:f9:0a:ad</code> the container got from ARP is the MAC address of docker0 on the host computer:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">ip</span> <span class="token function">link</span> show
<span class="token punctuation">..</span>.
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>NO-CARRIER,BROADCAST,MULTICAST,UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state DOWN mode DEFAULT group default 
    link/ether **02:42:8a:b4:55:4d** brd ff:ff:ff:ff:ff:ff
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li><strong>Resolve domain name (DNS)：</strong></li>
</ol>
<p>Also, the container needs to know the IP address of the target website, so that it will ask the name server(8.8.8.8) in order to resolve the domain name:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">02:42:ac:11:00:02 <span class="token operator">></span> **02:42:a1:f9:0a:ad**, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">73</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">46041</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">59</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2.37221 <span class="token operator">></span> <span class="token number">8.8</span>.8.8.53: <span class="token number">28492</span>+ A? www.baidu.com. <span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">)</span>
02:42:ac:11:00:02 <span class="token operator">></span> **02:42:a1:f9:0a:ad**, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">73</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">53494</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">59</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2.37221 <span class="token operator">></span> <span class="token number">8.8</span>.4.4.53: <span class="token number">28492</span>+ A? www.baidu.com. <span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">)</span>
02:42:ac:11:00:02 <span class="token operator">></span> **02:42:a1:f9:0a:ad**, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">73</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">46042</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">59</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2.37221 <span class="token operator">></span> <span class="token number">8.8</span>.8.8.53: <span class="token number">29411</span>+ AAAA? www.baidu.com. <span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">)</span>
02:42:ac:11:00:02 <span class="token operator">></span> **02:42:a1:f9:0a:ad**, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">73</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">53495</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">59</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2.37221 <span class="token operator">></span> <span class="token number">8.8</span>.4.4.53: <span class="token number">29411</span>+ AAAA? www.baidu.com. <span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">)</span>
**02:42:a1:f9:0a:ad** <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">132</span>: <span class="token punctuation">(</span>tos 0x20, ttl <span class="token number">101</span>, <span class="token function">id</span> <span class="token number">57650</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">118</span><span class="token punctuation">)</span>
    <span class="token number">8.8</span>.8.8.53 <span class="token operator">></span> <span class="token number">172.17</span>.0.2.37221: <span class="token number">28492</span> <span class="token number">3</span>/0/0 www.baidu.com. CNAME www.a.shifen.com., www.a.shifen.com. A <span class="token number">14.215</span>.177.38, www.a.shifen.com. A <span class="token number">14.215</span>.177.39 <span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span>
**02:42:a1:f9:0a:ad** <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">157</span>: <span class="token punctuation">(</span>tos 0x20, ttl <span class="token number">101</span>, <span class="token function">id</span> <span class="token number">29948</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>none<span class="token punctuation">]</span>, proto UDP <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>, length <span class="token number">143</span><span class="token punctuation">)</span>
    <span class="token number">8.8</span>.8.8.53 <span class="token operator">></span> <span class="token number">172.17</span>.0.2.37221: <span class="token number">29411</span> <span class="token number">1</span>/1/0 www.baidu.com. CNAME www.a.shifen.com. <span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>I’m not going to talk about the detail of DNS in this article. We only need to know that eventually, the container knew that the target IP is <code>14.215.177.38</code>.</p>
<ol>
<li><strong>Send packages (ICMP):</strong></li>
</ol>
<p>Now that the container’s already got the IP address of the target website and the MAC address of the gateway, it can send all the ICMP packages now:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">02:42:ac:11:00:02 <span class="token operator">></span> **02:42:a1:f9:0a:ad**, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">64</span>, <span class="token function">id</span> <span class="token number">31149</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">172.17</span>.0.2 <span class="token operator">></span> <span class="token number">14.215</span>.177.38: ICMP <span class="token builtin class-name">echo</span> request, <span class="token function">id</span> <span class="token number">69</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span>
**02:42:a1:f9:0a:ad** <span class="token operator">></span> 02:42:ac:11:00:02, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x20, ttl <span class="token number">51</span>, <span class="token function">id</span> <span class="token number">31149</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">14.215</span>.177.38 <span class="token operator">></span> <span class="token number">172.17</span>.0.2: ICMP <span class="token builtin class-name">echo</span> reply, <span class="token function">id</span> <span class="token number">69</span>, <span class="token function">seq</span> <span class="token number">0</span>, length <span class="token number">64</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>If we also use <code>tcpdump</code> to catch the package from ens192, we will get these contents:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ tcpdump -i ens192 -v -nn -e -t <span class="token function">host</span> <span class="token number">14.215</span>.177.38
00:50:56:ba:06:b7 <span class="token operator">></span> <span class="token number">70</span>:db:98:82:a1:c0, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x0, ttl <span class="token number">63</span>, <span class="token function">id</span> <span class="token number">13766</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">10.103</span>.80.33 <span class="token operator">></span> <span class="token number">14.215</span>.177.38: ICMP <span class="token builtin class-name">echo</span> request, <span class="token function">id</span> <span class="token number">113</span>, <span class="token function">seq</span> <span class="token number">20</span>, length <span class="token number">64</span>
<span class="token number">70</span>:db:98:82:a1:c0 <span class="token operator">></span> 00:50:56:ba:06:b7, ethertype IPv4 <span class="token punctuation">(</span>0x0800<span class="token punctuation">)</span>, length <span class="token number">98</span>: <span class="token punctuation">(</span>tos 0x20, ttl <span class="token number">41</span>, <span class="token function">id</span> <span class="token number">13766</span>, offset <span class="token number">0</span>, flags <span class="token punctuation">[</span>DF<span class="token punctuation">]</span>, proto ICMP <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, length <span class="token number">84</span><span class="token punctuation">)</span>
    <span class="token number">45.113</span>.192.101 <span class="token operator">></span> <span class="token number">10.103</span>.80.33: ICMP <span class="token builtin class-name">echo</span> reply, <span class="token function">id</span> <span class="token number">113</span>, <span class="token function">seq</span> <span class="token number">20</span>, length <span class="token number">64</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The whole process can be shown as:<br><img src="docker_bridge_external.png" alt="docker_bridge_external.png"></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/en/tags/Docker/" rel="tag">Docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/en/tags/Network/" rel="tag">Network</a></li></ul>

      
        
  <div id="vcomments"></div>
  
  <script> 
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
    loadScript("//unpkg.com/valine/dist/Valine.min.js");
    var oldLoadVa = window.onload;
    window.onload = function () {
      oldLoadVa && oldLoadVa();
      new Valine({
        el: '#vcomments',
        appId: '6AA1gXvoIRhGdQhCpYejA0Us-gzGzoHsz',
        appKey: 'OyxvagUt7NEgTT0JB4WwWIzx',
        placeholder: 'Comment',
        path: window.location.pathname,
        avatar: 'mp',
        meta: ["nick","mail","link"],
        pageSize: '10',
        lang: 'en',
        visitor: 'false',
        highlight: true,
        recordIP: true,
        
        
        
        enableQQ: 'false',
        requiredFields: [],
      });
    };
  </script>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
    
<nav id="article-nav">
  
    <a href="/en/2022/09/22/Deploy-cluster-on-Vsphere-using-cluster-api/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          [Cluster API] Deploy cluster on Vsphere
        
      </div>
    </a>
  
  
    <a href="/en/2022/05/08/About-Kubernetes-configuration-ConfigMap/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">About Kubernetes configuration: ConfigMap</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Overview"><span class="nav-number">1.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#None"><span class="nav-number">2.</span> <span class="nav-text">None</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Host"><span class="nav-number">3.</span> <span class="nav-text">Host</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Bridge"><span class="nav-number">4.</span> <span class="nav-text">Bridge</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#About-Bridge-mode"><span class="nav-number">4.1.</span> <span class="nav-text">About Bridge mode</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-container-with-bridge-mode-default"><span class="nav-number">4.2.</span> <span class="nav-text">Create container with bridge mode(default):</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Communication-between-pods"><span class="nav-number">4.3.</span> <span class="nav-text">Communication between pods</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Network-traffic-analysis"><span class="nav-number">4.3.1.</span> <span class="nav-text">Network traffic analysis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Communicate-with-external-network"><span class="nav-number">4.4.</span> <span class="nav-text">Communicate with external network</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Network-traffic-analysis-1"><span class="nav-number">4.4.1.</span> <span class="nav-text">Network traffic analysis</span></a></li></ol></li></ol></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/en/" class="mobile-nav-link">Home</a>
  
    <a href="/en/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/en/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/en/tags" class="mobile-nav-link">Tags</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2022 Lynn&#39;s Blog All Rights Reserved.
        
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次  
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
      var headerblur = document.getElementById("header-blur");
      headerblur.style.minHeight = window.getComputedStyle(document.getElementById("allheader"), null).height;
    
    
</script>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>




<script src="/en/js/script.js"></script>


<script src="/en/js/bootstrap.js"></script>


<script src="/en/js/main.js"></script>








  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
